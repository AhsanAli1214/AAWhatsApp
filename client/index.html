<!doctype html>
<html lang="en">
  <head>
    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-KP3HR8BD");
    </script>
    <!-- End Google Tag Manager -->
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-339VLBF7PM"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-339VLBF7PM");
    </script>
    <link rel="preconnect" href="https://flippantaside.com" />
    <link rel="dns-prefetch" href="https://flippantaside.com" />
    <link rel="preconnect" href="https://www.googletagmanager.com" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preload" as="script" href="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" />
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        await OneSignal.init({
          appId: "38db6760-af2d-4370-a1da-eced0fcd268f",
          safari_web_id: "web.onesignal.auto.07146831-e5cf-4801-bde7-1fd4b21ac045",
          notifyButton: {
            enable: true,
          },
          welcomeNotification: {
            "title": "Access Granted: AA Mods Elite ðŸ”“",
            "message": "Protocol initialized. You are now synced with the world's most secure WhatsApp mainframe. Stay tuned for zero-day updates.",
            "url": "https://aa-mods.vercel.app/aa-whatsapp/features"
          },
          promptOptions: {
            slidedown: {
              prompts: [
                {
                  type: "push",
                  autoPrompt: true,
                  text: {
                    actionMessage: "Sync your device with the AA Mods Security Mainframe? You'll receive real-time Anti-Ban patches and Elite feature releases.",
                    acceptButton: "Initialize Sync",
                    cancelButton: "Stay Offline"
                  },
                  delay: {
                    pageViews: 1,
                    timeDelay: 3
                  }
                }
              ]
            }
          },
          persistence: {
            "title": "AA Mods Security Status",
            "message": "Elite subscription active. Mainframe sync: Online.",
            "url": "https://aa-mods.vercel.app"
          }
        });
        
        OneSignal.on('subscriptionChange', function(isSubscribed) {
          if (isSubscribed) {
             console.log('The user is subscribed');
             // Manually trigger the welcome notification or a specific message if needed
             // though init's welcomeNotification already handles this, 
             // we can ensure it by sending a specific tag or event if the SDK allows.
          }
        });

        // Ensure welcome notification is sent immediately after permission is granted
        OneSignal.on('notificationPermissionChange', function(permissionChange) {
          console.log('Notification permission changed:', permissionChange);
          if (permissionChange === 'granted') {
             // The SDK automatically sends the welcomeNotification configured in init() 
             // when the user subscribes for the first time.
          }
        });
      });
    </script>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1"
    />
    <meta name="referrer" content="no-referrer-when-downgrade" />
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-KP3HR8BD"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
